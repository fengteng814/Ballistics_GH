# 1. 项目定位与总目标
本项目在 Rhino 统一坐标系下，利用 Grasshopper 作为参数化与计算编排环境，构建一套 **Trap / Skeet 场地—射击位—靶轨—弹道** 的统一三维模型与评估工具，用于：
1. **规则边界建模**：按 ISSF 规则/设定表生成射击位、靶机窗口与靶轨集合。
2. **弹道计算**：根据枪口初始条件与外弹道模型生成轨迹、落点与包络。
3. **耦合分析**：射击位 × 靶轨 × 弹道，提取关键临界轨迹。
4. **档弹网引入**：提取Rhino中档弹网模型，计算各类工况中子弹外逸情况。
5. **可复算交付**：以 GH 定义为主载体，可一键复算、可导出 JSON/CSV/几何（3dm/obj）用于论文与后续设计。
# 2. 使用方式
打开 Rhino 模型 + GH 定义 → 选择比赛类型/射击位/设定表 → 计算 → 直接在 Rhino 视窗中查看 3D 结果并导出数据。
# 3. 系统边界
**范围内**
- Rhino 坐标系下的场地与射击位参数化建模
- Trap/Skeet 靶轨生成（含设定表/窗口规则约束）
- AimDirs（射击方向集合）Tree 化组织、分支语义稳定
- 耦合链路：
    - 快链路：射线/几何求交或最近距离（用于“命中/临界方向”）
    - 慢链路：外弹道积分（用于落弹点/包络/越界判据）
- Rhino 内可视化（曲线、点、管线、颜色分组、图层/对象标识）
- 数据导出（JSON 为主，必要时 CSV）
# 4. Rhino + GH 的总体架构
## 4.1 交付形态
一个 GH 定义（推荐拆为若干 Cluster / 子定义），可在 Rhino 8 中直接运行复算
## 4.2 模块分解
1. **弹道计算模块 A：外弹道积分链路**
    - 独立模块，用于结合试验校核场地、枪弹参数。
    - 输入：初速、仰角/方位、阻力系数（Cd 或等效阻力模型参数）、质量、直径、空气密度等
    - 输出：轨迹 polyline、落点、最大高度、飞行时间、速度衰减曲线（可选）
2. **输入与坐标系模块**
    - 统一坐标系：原点、X/Y 方向、地面基准、枪口高度
    - 场地参数：射击位布置半径、站位点坐标、靶机位置等
3. **规则/设定表模块（Trap/Skeet）**
    - Trap：设定表（setting tables）→ 每台靶机轨迹参数（方向/仰角/速度/窗口）
    - Skeet：高塔/低塔窗口约束与标准轨迹参数
4. **靶轨生成模块**
    - 输出：靶轨曲线/点列（带时间参数或可推导的速度-时间映射）
    - 规则过滤：例如 Trap 每个射击位仅计算“正对的 3 个靶位/窗口”（你之前明确强调过的逻辑）
5. **AimDirs 生成/输入模块**
    - 每个分支代表一个“业务组合”（射击位/靶机/表格/时间点/采样组等）
    - 每个分支包含 N 个方向向量
6. **耦合分析模块 A：射线/几何链路
    - 构造 Ray：Origin + AimDir
    - 与靶轨：求交（或最近距离点）
    - 输出（Tree 对齐）：命中点、最近距离、对应靶轨参数 t、对应 Ray 参数 s、以及可解释的 Az/El
7. **关键轨迹提取与指标模块**
    - “最远落弹”轨迹
    - “临界越界/越网”轨迹
    - 落弹外逸面积/比例、临界方向集合
8. **可视化与对象管理模块（Rhino 视窗）**
    - 输出几何进入 Rhino：曲线/点/网格/包络面
    - 分组着色与图层组织
    - 建议写入对象 UserText：station、machine、table、time_id、dir_id、is_critical 等，便于后续筛选与复算追踪
9. **导出模块**
    - JSON：保存“输入参数 + 关键结果 + 版本号”
    - CSV：必要时导出统计表（例如每射击位最远落弹、临界越界阈值）
# 5. 项目实现工作流
在GH引入外部csx文件至GH的script电池块中进行编译，csx代码无需按照SDK封装。
